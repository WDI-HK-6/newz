app.controller('HomeCtrl', ['$scope', '$http', '$rootScope', function($scope, $http, $rootScope ){

  $scope.feature = {
    heading: "Your heading",
    author: "author (you)",
    article_text: "Put a birthday message here"
  };

  

  $scope.clear = function() {
    $scope.card.date = null;
  };
  $scope.minDate = new Date("1946-01-01");
  console.log("mindate is ", $scope.minDate);
  $scope.maxDate = new Date();
  $scope.open = function($event) {
    $event.preventDefault();
    $event.stopPropagation();

    $scope.opened = true;
  };
  $scope.dateOptions = {
    'year-format': "'yy'",
    'starting-day': 1
  };

  $scope.selectDate = function(date) {
    console.log("in selectDate");
    year = moment(date).format('YYYY');
    $http.get('movies/' + year + '.json').success(function(data){
      $scope.card.movie = data.movie[0]["bestMovie"];
      $scope.card.producers = data.movie[0]["producers"];
      $scope.card.nominees = data.movie[0]["nominees"];
      $scope.card.producersExist = data.movie[0]["producersExist"];
      $scope.card.bestActor = data.movie[0]["bestActor"];
      $scope.card.bestActress = data.movie[0]["bestActress"];
      $scope.card.bestActorMovie = data.movie[0]["bestActorMovie"];
      $scope.card.bestActressMovie = data.movie[0]["bestActressMovie"];
    })
    $http.get('songlists/' + year + '.json').success(function(data){
      console.log(data);
      console.log(data['songlist']);
      $scope.card.songlist = data['songlist'];
      // console.log($scope.songs.songlist);
    })
    getHoroscopes(date);
  }
  var getZodiacData = function() {
    console.log("here in zodiac data");
  }

  var getHoroscopes = function(date) {
    newDate = moment(date).format("YYYY-MMMM-DD");
    console.log("the date is ", newDate);
    // console.log("the year is ", moment(date).year();
    // console.log("the month is ", moment(date).month();
    // console.log("the day is ", moment(date).date();
    $http.get('zodiac/' + newDate).success(function(data){
      console.log("here in gethoroscopes data");
      console.log(data);
      getZodiacData(data);
    })
  }

  $scope.repack = function() {
    $scope.$container.packery();
  }

  $scope.$container = $('#container');
  // init
  $scope.$container.packery({
    itemSelector: '.item',
    columnWidth: 100,
    rowHeight: 50,
    "stamp": ".stamp"

  });

  $scope.$container.find('.item').each( function( i, itemElem ) {
    // make element draggable with Draggabilly
    var draggie = new Draggabilly( itemElem );
    // bind Draggabilly events to Packery
    $scope.$container.packery( 'bindDraggabillyEvents', draggie );
  });

  $scope.card = {};
  $scope.card.date = new Date("October 13, 1980 11:13:00");
  $scope.selectDate($scope.card.date);
  $scope.repack();

}])

